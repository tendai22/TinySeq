# TinySeq仕様書

## TinySeqとは

TinySeqは単純なシーケンサです。ラダー形式で記述したプログラムを定期的に実行し、デジタル入力の変化に応じてデジタル出力を制御します。

シーケンサが実行する「プログラム」(`ラダー`と言います)をテキストとして記述し、シリアルポートから流し込めば実行開始できます。

シーケンサが実行するアプリケーションは、複数の入力端子と出力端子を持ち、スイッチとリレーを組み合わせて回路を構成することで実現されます。リレーとは、コイルとスイッチから成り、コイルに通電するとスイッチが切り替わる機能を持つデバイスです。スイッチとリレーを組み合わせ構成される回路を記述したものが`ラダー`です。

### ラダーの例

本シーケンサが実行可能な回路の例を以下にあげます。

```
|- X000.a -|1
|- M000.a -|1- M000 -|
```

X000.a はスイッチです。M000はリレーのコイルを表します。左端と右端の間に電圧をかけた状態で、スイッチX000を押すと、X000.aが導通します。X000.aの右側の端子はリレーM000に接続されているので、M000に電流が流れコイルに磁力が生まれ、リレーM000の接点がONになります。

M000.a はリレーの接点(contact)です。これはリレーのコイルに電流が流れるとONになります。M000.aの他方の端子もリレーM000に接続されているので、スイッチX000から手を放しても、コイルM000には電流は流れ続け、接点M000はON状態を継続します。こうして、一度X000を押すと、以後リレーM000は導通を続ける回路であることがわかります(自己保持回路)。

## 構成要素

### スイッチ

スイッチは`Xnnn.a` または`Xnnn.b`で表します。入力端子が1になっているとき、スイッチはONになります。
スイッチは「normally on」のものと、「normally off」のものがあります。前者はX000.a、後者はX000.bのように、dot a, dot bを後ろにつけます(a接点、b接点)。

### リレー

リレーはコイルと接点からなります。リレーには以下の４種類があります。

* 通常のリレー、コイル: Mnnn、接点: Mnnn.a, Mnnn.b
* 出力リレー、コイル: Ynnn (接点はありません)
* ON-Delayリレー、Nnnn、接点: Nnnn.a, Nnnn.b
* OFF-Dekayリレー、Fnnn、接点: Fnnn.a, Fmmm.b

コイル名の後ろに、`.a`, `,b`を付けることでa接点、b接点を表します。

### 通常のリレー

非通電時にa接点はOFF、b接点はONになります。通電時は逆で、a接点はON、b接点はOFFになります。

### 出力リレー

出力端子に直結しているリレーで、コイルに通電すると、対応する出力端子が1になります。接点がないことが建前ですが、実際には、ラダー中でa接点、b接点を記述することができます。

### ON Delayリレー

コイルに通電すると、通電直後はOFFのままで、一定時間後に端子がONになる特殊なリレーです。ONになるまでの間に通電がとだえると待ち時間のタイマはクリアされ、再度通電が始まってから改めてカウントダウンが始まります。コイルはNnnn, 端子は Nnnn.a, Nnnn.bで表します。

### OFF Delayリレー

コイルに通電すると即座にONになりますが、一定時間後に自動的にOFFになる特殊なリレーです。カウントダウン満了前に通電がとだえると、その時点でOFFになります。