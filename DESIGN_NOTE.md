# TinySeqデザインノート

[MOTIVATION.md](MOTIVATION.md)でTinySeqの背景を簡単に説明した。ここでは、システムとしてのTinySeqの要件、概要仕様、実装上の留意点を中心に説明する。

# 要件

## システム

* 制御盤からの24Vで動作すること
* IN 18本以上、OUT 12本以上に対応すること。
* 機械に取り付けた状態で、ノートPCからUSBシリアルケーブルを接続してラダープログラム・ファームウェアを更新できること。

## ハードウェア

### コントローラI/O側とマイクロコントローラI/Oの間をアイソレートすること

IN/OUT端子はすべてフォトカプラを介してマイクロコントローラと接続する。コントローラ側は24V電流駆動(電流ON==1, 電流OFF==0)、OUT側は、コントローラのIN端子に接続する。

* コントローラのIN端子もフォトカプラでシンク側(グランドがCOMMON端子でシーケンサ側に出ている)のため、TinySeq側はソース側(フォトカプラ出力トランジスタのプラス側を24V側に接続する)とする。電流制限抵抗はコントローラ側に内蔵されているので、フォトカプラのマイナス側はTinySeqのOUT端子に直結する。
* コントローラのOUT端子はソース側になる。TinySeqのIN端子は電流制限抵抗(2.7kΩ)を介してフォトカプラの入力LEDを経てGNDにつながれる。

### マイクロコントローラ側電源も、24V側から受ける場合と、24V側とアイソレートした状態と両方存在する。

* スタンドアロンで動く→24V側から供給(DC-DCコンバータで降圧して供給)
* PCとシリアル接続(ラダープログラム開発時)→24V側から供給
* ファーム書き換え→24V側とアイソレート、PC側(MPLAB SNAP側)から電源供給

基板構成を、CPU基板とフォトカプラ基板の2つとする。24Vはフォトカプラ側に供給し、フォトカプラ

CPUへの給電は、24V側からの降圧と、外部USBシリアルからの2つにする。

### 基板構成



* マイクロコントローラ+ I/O Expander + EEPROM搭載の基板と